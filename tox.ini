[tox]
envlist = lint, type, unit, integration, security, compliance

[testenv:lint]
deps = ruff
commands = ruff check src tests

[testenv:format]
deps = ruff
commands = ruff check --fix src tests

[testenv:type]
deps =
    mypy
    types-pyyaml
commands = mypy src

[testenv:unit]
deps =
    pytest
    pytest-cov
    pytest-asyncio
commands = pytest tests/unit {posargs}

[testenv:integration]
deps =
    pytest
    pytest-asyncio
commands = pytest tests/integration --override-ini="addopts=-v --strict-markers" {posargs}

[testenv:security]
deps =
    bandit
    safety
commands =
    bandit -c pyproject.toml -r src
    safety scan --full-report

[testenv:compliance]
deps =
    requests
commands =
    python scripts/validate_toolchain.py

[testenv:serve]
deps =
    uvicorn
    fastmcp
commands =
    uvicorn src.app:app --host 0.0.0.0 --port 8000